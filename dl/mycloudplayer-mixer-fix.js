function setupFilter(n){n.type=BiquadFilterType[0];n.Q.value=0}function setupEQ(){bassA.type=BiquadFilterType[3];bassA.frequency.value=lowFreq;bassA.Q.value=2;bassA.gain.value=0;gainBassA.gain.value=.5;trebleA.type=BiquadFilterType[4];trebleA.frequency.value=hiFreq;trebleA.Q.value=2;trebleA.gain.value=0;gainTrebleA.gain.value=.5;bassB.type=BiquadFilterType[3];bassB.frequency.value=lowFreq;bassB.Q.value=0;bassB.gain.value=0;gainBassB.gain.value=.5;trebleB.type=BiquadFilterType[4];trebleB.frequency.value=hiFreq;trebleB.Q.value=0;trebleB.gain.value=0;gainTrebleB.gain.value=.5;midA.type="peaking";midA.frequency.value=midFreq;midA.Q.value=2;gainMidA.gain.value=.5;midB.type="peaking";midB.frequency.value=midFreq;midB.Q.value=2;gainMidB.gain.value=.5}function resetConnectionsA(){sourceA&&(sourceA.disconnect(0),gainNodeA.disconnect(0),gainNodeAA.disconnect(0),bassA.disconnect(0),midA.disconnect(0),trebleA.disconnect(0),gainBassA.disconnect(0),gainMidA.disconnect(0),gainTrebleA.disconnect(0),analyserA.disconnect(0),analyserAW.disconnect(0),filterA.disconnect(0),jsProcessorA.disconnect(0));setTimeout(function(){sourceA=context.createMediaElementSource(audioA);sourceA.connect(analyserAW);analyserAW.connect(gainNodeA);gainNodeA.connect(bassA);gainNodeA.connect(midA);gainNodeA.connect(trebleA);bassA.connect(gainBassA);midA.connect(gainMidA);trebleA.connect(gainTrebleA);gainBassA.connect(filterA);gainMidA.connect(filterA);gainTrebleA.connect(filterA);filterA.connect(analyserA);analyserA.connect(gainNodeAA);gainNodeAA.connect(context.destination);setupEQ();gainNodeAA.connect(jsProcessorA);jsProcessorA.connect(context.destination);jsProcessorA.onaudioprocess=processAudioA},50)}function resetConnectionsB(){sourceB&&(sourceB.disconnect(0),gainNodeB.disconnect(0),gainNodeBB.disconnect(0),analyserB.disconnect(0),bassB.disconnect(0),midB.disconnect(0),trebleB.disconnect(0),gainBassB.disconnect(0),gainMidB.disconnect(0),gainTrebleB.disconnect(0),filterB.disconnect(0));setTimeout(function(){sourceB=context.createMediaElementSource(audioB);sourceB.connect(analyserBW);analyserBW.connect(gainNodeB);gainNodeB.connect(bassB);gainNodeB.connect(midB);gainNodeB.connect(trebleB);bassB.connect(gainBassB);midB.connect(gainMidB);trebleB.connect(gainTrebleB);gainBassB.connect(filterB);gainMidB.connect(filterB);gainTrebleB.connect(filterB);filterB.connect(analyserB);analyserB.connect(gainNodeBB);gainNodeBB.connect(context.destination)},50)}function createAudioA(){window.audioA=null;window.audioA=new Audio;audioA.id="audioA";audioA.crossOrigin="anonymous";audioA.controls=!1;audioA.preload=!0;audioA.webkitPreservesPitch=!0;$("#playA").attr("disabled","disabled").removeClass("active");document.querySelector("#myaudioA").innerHTML="";document.querySelector("#myaudioA").appendChild(audioA);resetConnectionsA();var n=document.querySelector("#current-timeA");audioA.addEventListener("timeupdate",function(){var i=audioA.currentTime,t=audioA.duration;t&&(n.textContent=timecodeS(Math.floor(t-i))+" / "+timecodeS(Math.floor(t)),$("#divWaveA .played").css("width",i*100/t+"%"))},!1);audioA.addEventListener("progress",onprogressHTML,!1);audioA.addEventListener("loadeddata",function(){$("#playA").removeAttr("disabled")});$("#volumeA").val(7).trigger("change");sliderChange($("#volumeA")[0]);sliderChange($("#crossFade")[0])}function createAudioB(){window.audioB=null;window.audioB=new Audio;audioB.id="audioB";audioB.crossOrigin="anonymous";audioB.controls=!1;audioB.preload=!0;audioB.webkitPreservesPitch=!0;$("#playB").attr("disabled","disabled").removeClass("active");document.querySelector("#myaudioB").innerHTML="";document.querySelector("#myaudioB").appendChild(audioB);resetConnectionsB();var n=document.querySelector("#current-timeB");audioB.addEventListener("timeupdate",function(){var i=audioB.currentTime,t=audioB.duration;t&&(n.textContent=timecodeS(Math.floor(t-i))+" / "+timecodeS(Math.floor(t)),$("#divWaveB .played").css("width",i*100/t+"%"))},!1);audioB.addEventListener("progress",onprogressHTML,!1);audioB.addEventListener("loadeddata",function(){$("#playB").removeAttr("disabled")});$("#volumeB").val(7).trigger("change");sliderChange($("#volumeB")[0]);sliderChange($("#crossFade")[0])}function rafCallback(){var r,h,u,c,o,f,e,i,n,t,s;for(window.requestAnimationFrame(rafCallback,canvas),sourceA&&sourceA.mediaElement&&!sourceA.mediaElement.paused&&(r=new Uint8Array(analyserA.frequencyBinCount),analyserA.getByteFrequencyData(r),h=new Uint8Array(analyserAW.frequencyBinCount),analyserAW.getByteFrequencyData(h),analyserAW.smoothingTimeConstant=0,analyserAW.fftSize=512,o=getAverageVolume(r),ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx.fillStyle=gradient,ctx.lineCap="round",ctx.fillRect((numBars-1)*SPACER_WIDTH,CANVAS_HEIGHT,BAR_WIDTH*2,-o/2),drawSpectrogram2(h,rtWaveADom)),sourceB&&sourceB.mediaElement&&!sourceB.mediaElement.paused&&(u=new Uint8Array(analyserB.frequencyBinCount),analyserB.getByteFrequencyData(u),c=new Uint8Array(analyserBW.frequencyBinCount),analyserBW.getByteFrequencyData(c),analyserBW.smoothingTimeConstant=0,analyserBW.fftSize=512,o=getAverageVolume(u),ctx2.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),ctx2.fillStyle=gradient,ctx2.lineCap="round",ctx2.fillRect(0,CANVAS_HEIGHT,BAR_WIDTH*2,-o/2),drawSpectrogram2(c,rtWaveBDom)),f=1,e=1,r&&(f=Math.floor(r.length/numBars)-1),u&&(e=Math.floor(u.length/numBars)-1),i=0;i<numBars*coef-2;++i){if(n=0,sourceA&&sourceA.mediaElement&&!sourceA.mediaElement.paused){for(t=0;t<f;++t)n+=r[i*f+t];ctx.fillStyle=hot.getColor(n/f+70).hex();s=n/f/256*80;ctx.fillRect(i/coef*SPACER_WIDTH,CANVAS_HEIGHT,BAR_WIDTH/coef,-s)}if(n=0,sourceB&&sourceB.mediaElement&&!sourceB.mediaElement.paused){for(t=0;t<e;++t)n+=u[i*e+t];ctx.fillStyle=hot.getColor(n/e+70).hex();s=n/e/256*80;ctx2.fillRect((i/coef+3)*SPACER_WIDTH,CANVAS_HEIGHT,BAR_WIDTH/coef,-s)}}}function getPeaks(n){for(var r,i,c=this,u=n.getChannelData(0).length/CANVAS_WIDTH,e=Array.prototype.slice,f=[],t=0;t<CANVAS_WIDTH;t++){for(r=0,i=0;i<n.numberOfChannels;i++){var o=n.getChannelData(i),s=e.call(o,t*u,(t+1)*u),h=Math.max.apply(Math,s.map(Math.abs));r+=h}f[t]=r}return f}function drawFrameCall(n,t){var i=getPeaks(n);i&&i.forEach(function(n,i){drawFrame(i,n,1,t)})}function drawFrame(n,t,i,r){var e=1,o=Math.round(t*(50/i)),s=n*e,h=Math.round((50-o)/2),f=r,u=f.getContext("2d"),c=r,v=c.getContext("2d"),l=$(f).width(),a=$(f).height();u.fillStyle=hot.getColor(t/i*256).hex();u.lineCap="round";u.fillRect(l-1,0,1,a);u.fillStyle=gradient;u.fillRect(s,h,e,o)}function drawSpectrogram2(n,t){var s=t.id=="waveA"?"A":"B",e,h=t,i=h.getContext("2d"),c=t,l=c.getContext("2d"),u=$(h).width(),f=$(h).height(),r,a,o;l.drawImage(c,0,0,u,f);r=getAverageVolumeSQ(n);s=="A"?(avgMaxVolA<r&&(avgMaxVolA=r),e=avgMaxVolA):s=="B"&&(avgMaxVolB<r&&(avgMaxVolB=r),e=avgMaxVolB);i.fillStyle=hot.getColor(0).hex();i.lineCap="round";i.fillRect(u-1,0,1,f);a=t.id=="waveA"?audioA.currentTime:audioB.currentTime;i.fillStyle=hot.getColor(r/e*256).hex();o=Math.pow(r/e,5)*15;s=="A"?i.fillRect(u-1,f-o*2,1,o*2):i.fillRect(u-1,0,1,o*2);i.translate(-1,0);i.drawImage(c,0,0,u,f,0,0,u,f);i.setTransform(1,0,0,1,0,0)}function onLoad(){rafCallback()}function GetTracks(n){results=n.split(",");newurl="//api.soundcloud.com/tracks?format=json&ids="+n+"&limit=200&consumer_key="+soundCloudApiKey;$.ajax({url:newurl,success:function(n){tracks=OrderTracks(n,results);AddRows(tracks)}})}function OrderTracks(n,t){for(var r=[],i=0;i<t.length;i++)$.each(n,function(n,u){u.id.toString()==t[i].toString()&&r.push(u)});return r}function showLoading(){$("#chart tbody").html('<tr><td colspan=7 align="center" style="padding:5px;"><div class="loader"><\/div><\/tr>')}function GetUserTracks(n,t){showLoading();var i="//api.soundcloud.com/users/"+n+"/"+t+".json?consumer_key="+soundCloudApiKey+"&limit=200";$.ajax({url:i,success:function(n){tracks=n;AddRows(tracks)}})}function SearchTracks(){showLoading();var n=$("#tbSearch").val(),t="https://api.soundcloud.com/tracks?format=json&q="+n+"&consumer_key="+soundCloudApiKey+"&filter=streamable&limit=200";$.ajax({url:t,timeout:1e4,success:function(n){tracks=n;AddRows(n)}});GACall("q",encodeURIComponent(n),!0)}function LoadTracksByGenre(n,t){showLoading();t=t=="date"?"created_at":"hotness";var i="https://api.soundcloud.com/tracks?format=json&genres="+encodeURIComponent(n)+"&order="+t+"&consumer_key="+soundCloudApiKey+"&limit=200";$.ajax({url:i,timeout:1e4,success:function(n){tracks=n.collection||n;AddRows(tracks)}});GACall("Genre",encodeURIComponent(n),!1)}function GetTracksByBPM(n){showLoading();var t="https://api.soundcloud.com/tracks?format=json&bpm[from]="+(eval(n)-3)+"&bpm[to]="+(eval(n)+3)+"&consumer_key="+soundCloudApiKey2+"&limit=100";$.ajax({url:t,timeout:1e4,success:function(n){tracks=n.collection||n;AddRows(tracks)}})}function GetPlaylist(n){var t=n?n:getParam("spid").split("#")[0].split("%23")[0];t&&(showLoading(),$.ajax({url:"https://mycloudplayers.com/svc/getPlaylists.ashx",dataType:"json",type:"post",data:{pid:t},success:function(n){if(n){results=n[0][2].toString().split(",");playlistName=n[0][1];var t=n[0][2];GetTracks(t)}}}))}function CreatePlaylists(){for(var t="",n=0;n<presetPlaylists.length;n++)t+='<li bpm="'+presetPlaylists[n].bpm+'">'+presetPlaylists[n].title+"<\/li>";$("#samplePlaylists").html(t)}function CreateGenrePlaylists(){for(var t="",n=0;n<genrePlaylists.length;n++)t+='<li genre="'+genrePlaylists[n]+'">'+genrePlaylists[n]+"<\/li>";$("#genrePlaylists").html(t)}function getTopCountries(){$.ajax({url:"https://mycloudplayers.com/svc/getChartsGA.ashx",dataType:"json",type:"get",data:{method:"top"},success:function(n){var i="",t;for(i+='<li country="">All<\/li>',t=0;t<n.length;t++)i+='<li country="'+n[t][0]+'">'+n[t][0]+"<\/a><\/li>";$("#topTracks").html(i)}})}function getTopTracks(n){showLoading();$.ajax({url:"https://mycloudplayers.com/svc/getChartsGA.ashx",dataType:"json",type:"get",data:{country:n},success:function(n){for(var i="",t=0;t<n.length;t++)i+=n[t][0]+",";GetTracks(i)}})}function GetUserPlaylists(n){$.ajax({url:"https://mycloudplayers.com/svc/getplaylists.ashx",dataType:"json",type:"post",data:{user:n},success:function(n){CreateUserPlaylists(n)}})}function getTrackArtwork(n,t){return n.artwork_url?n.artwork_url.replace("large",t?t:"large"):n.user.avatar_url&&n.user.avatar_url.indexOf("default_avatar")==-1?n.user.avatar_url.replace("large",t?t:"large"):"https://googledrive.com/host/0BykPJZkgE0etd2xCckwyMFd4Z1k/css/images/blank.gif"}function getUserArtwork(n,t){return n.avatar_url?n.avatar_url.replace("large",t?t:"large"):"https://googledrive.com/host/0BykPJZkgE0etd2xCckwyMFd4Z1k/css/images/blank.gif"}function CreateUserPlaylists(n){for(var i='<li key="tracks">Your Tracks<\/li><li key="favorites">Your Favorites<\/li>',t=0;t<n.length;t++)i+='<li pid="'+n[t][0]+'">'+n[t][1]+"<\/li>";$("#userPlaylists").html(i)}function replaceImage(n){var i=tracks[$(n).parent().parent().attr("i")],t=getUserArtwork(i.user);n.src!=t&&(n.src=t)}function AddRows(n){var i="",t,r=$(document).width();$.each(n,function(n,r){if(t=r,t!=""&&t.streamable&&t.stream_url){var u="";t.bpm&&(u='<a style="float:none;" href="javascript:;" title="Browse '+t.bpm+' BPM tracks">'+t.bpm+"<\/a>");i+='<tr i="'+n+'">';i+='<td class="artwork"><img class="artwork" onerror="replaceImage(this);" src="'+getTrackArtwork(t)+'" /><\/td>';i+='<td class="playA">A<\/td>';i+='<td class="playB">B<\/td>';i+='<td class="title"><div class="trtitle"><a>'+t.title+"<\/a>";i+='<a class="user" href="#!/tracks='+t.user.permalink+'">'+t.user.username+"<\/em>";i+="<\/div><\/td>";i+='<td class="time">'+timecode(t.duration)+"<\/td>";i+='<td class="genre">'+(t.genre?'<a style="float:none;" href="javascript:;" title="Browse '+t.genre+' tracks">'+t.genre+"<\/a>":"")+"<\/td>";i+='<td class="bpm">'+u+"<\/td>";i+="<\/tr>"}});$("#chart thead").html('<tr><th><\/th><th colspan="2" >Deck<\/th><th class="title">Title<\/th><th class="time">Length<\/td><th class="genre" >Genre<\/td><th class="bpm" >BPM<\/td><\/tr>');$("#chart tbody").html(i);$("#tracksWrapper").css("bottom",$(".googleAd").height());trackA||$(".playA")[0].click();trackB||$(".playB")[1].click()}function getAdHtml(){var n=$(window).width();return n>1480?'<div>Ads by Google. <em>You can support this app by clicking on these Ads once in a while<\/em><br/><ins class="adsbygoogle"        style="display:inline-block;width:728px;height:90px"        data-ad-client="ca-pub-4882613019041839"        data-ad-slot="9013126504"><\/ins>':'<div>Ads by Google. <em>You can support this app by clicking on these Ads once in a while<\/em><br/><ins class="adsbygoogle"        style="display:inline-block;width:468px;height:60px"        data-ad-client="ca-pub-4882613019041839"        data-ad-slot="6829886107"><\/ins>'}function getParam(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.href);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))}function getParamH(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\#&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(window.location.hash.replace("!/",""));return t==null?undefined:decodeURIComponent(t[1].replace(/\+/g," "))}function timecode(n){var t=function(n){return{h:Math.floor(n/36e5),m:Math.floor(n/6e4%60),s:Math.floor(n/1e3%60)}}(n),i=[];return(t.h>0&&i.push(t.h),isNaN(t.m))?"n/a":(i.push(t.m<10&&t.h>0?"0"+t.m:t.m),i.push(t.s<10?"0"+t.s:t.s),i.join(":"))}function timecodeS(n){var t=function(n){return{h:Math.floor(n/3600),m:Math.floor(n/60%60),s:n%60}}(n),i=[];return t.h>0&&i.push(t.h),i.push(t.m<10&&t.h>0?"0"+t.m:t.m),i.push(t.s<10?"0"+t.s:t.s),i.join(":")}function getExp(n){return Math.pow(2,n)}function getLog(n){return Math.log2(n)}function sliderChange(n){var t,i;n.id=="volumeA"?gainNodeA.gain.value=n.value/10:n.id=="volumeB"?gainNodeB.gain.value=n.value/10:n.id=="kQA"?changeQuality(filterA,n.value/100):n.id=="kFreqA"?changeFrequency(filterA,n.value/100):n.id=="kQB"?changeQuality(filterB,n.value/100):n.id=="kFreqB"?changeFrequency(filterB,n.value/100):n.id=="midA"?(t=getLog(n.value)*2,midA.gain.value=t*8):n.id=="midB"?(t=getLog(n.value)*2,midB.gain.value=t*8):n.id=="trebleA"?(t=getLog(n.value)*2,trebleA.gain.value=t*8):n.id=="bassA"?(t=getLog(n.value)*2,bassA.gain.value=t*8):n.id=="trebleB"?(t=getLog(n.value)*2,trebleB.gain.value=t*8):n.id=="bassB"?(t=getLog(n.value)*2,bassB.gain.value=t*8):n.id=="pitchA"?(pitchA=n.value,audioA.playbackRate=pitchA,$tempoA.attr("val")&&(i=eval($tempoA.attr("val"))*pitchA,$tempoA.text(i.toFixed(2)),$tempoADiff.text((i-eval($tempoA.attr("val"))).toFixed(2)))):n.id=="pitchB"&&(pitchB=n.value,audioB.playbackRate=pitchB,$tempoB.attr("val")&&(i=eval($tempoB.attr("val"))*pitchB,$tempoB.text(i.toFixed(2)),$tempoBDiff.text((i-eval($tempoB.attr("val"))).toFixed(2))))}function crossFade(n){var t=parseInt(n.value)/parseInt(n.max),i=Math.cos(t*.5*Math.PI),r=Math.cos((1-t)*.5*Math.PI);gainNodeAA.gain.value=i;gainNodeBB.gain.value=r}function modifyOffset(){var n,t,i,u,f,r;for(width=this.offsetWidth,n=(this.value-this.getAttribute("min"))/(this.getAttribute("max")-this.getAttribute("min")),i=-1,n<0?t=0:n>1?t=width:(t=width*n+i,i-=n),u=this.parentNode.childNodes,r=0;r<u.length;r++)sibling=u[r],sibling.id==this.id&&(f=!0),f==!0&&sibling.nodeName=="OUTPUT"&&(outputTag=sibling);outputTag.style.left=t+10+"px";outputTag.style.marginLeft=i+"%";outputTag.innerHTML=this.value}function modifyInputs(){var n=$("input.output");$.each(n,function(t){if(n[t].getAttribute("type")=="range")if(n[t].onchange=modifyOffset,n[t].onmousemove=modifyOffset,"fireEvent"in n[t])n[t].fireEvent("onchange");else{var i=document.createEvent("HTMLEvents");i.initEvent("change",!1,!0);n[t].dispatchEvent(i)}})}function ProcessParams(){getParamH("bpm")?GetTracksByBPM(getParamH("bpm")):getParam("spid")?GetPlaylist(getParam("spid")):getParamH("genre")?LoadTracksByGenre(getParamH("genre")):getParamH("spid")?GetPlaylist(getParamH("spid")):getParamH("tracks")?GetUserTracks(getParamH("tracks"),"tracks"):getParamH("favorites")?GetUserTracks(getParamH("favorites"),"favorites"):getParamH("country")!=undefined&&getTopTracks(getParamH("country"))}function DefineDomElements(){$waveALoaded=$("#divWaveA .loaded");$waveBLoaded=$("#divWaveB .loaded");rtWaveADom=$("#waveA")[0];rtWaveBDom=$("#waveB")[0];$tempoA=$("div#enInfoA .tempo");$tempoB=$("div#enInfoB .tempo");$tempoADiff=$("div#enInfoA .diff");$tempoBDiff=$("div#enInfoB .diff")}function BindEvents(){$(document).on("click",".playA",function(){$(".playA").removeClass("active");$(this).addClass("active");var n=tracks[$(this).parent().attr("i")];$("#deckA .trackInfo").html(n.title+" by "+n.user.username);trackA=n;echoA=null;createAudioA();audioA.src=n.stream_url+"?consumer_key="+soundCloudApiKey;makeWaveforms(n.waveform_url,$("#divWaveA"));GACall("play",n.id,!1,!1,n.duration)});$(document).on("click",".playB",function(){$(".playB").removeClass("active");$(this).addClass("active");var n=tracks[$(this).parent().attr("i")];$("#deckB .trackInfo").html(n.title+" by "+n.user.username);trackB=n;echoB=null;createAudioB();makeWaveforms(n.waveform_url,$("#divWaveB"));audioB.src=n.stream_url+"?consumer_key="+soundCloudApiKey;GACall("play",n.id,!1,!1,n.duration)});$(".sync").bind("click",function(){Sync(this)});$(".beatMatch").bind("click",function(){BeatMatch(this)});$(".tempo").bind("click",function(){ChangeTempo(this)});$(".pbControls .play").bind("click",function(){PlayPause(this)});$("input.vertical").bind("change input",function(){sliderChange(this)});$("#crossFade").bind("change input",function(){crossFade(this)});$("#fbA").bind("mousedown",function(){audioA.playbackRate=eval($("#pitchA").val())-.05}).bind("mouseup",function(){audioA.playbackRate=eval($("#pitchA").val())});$("#ffA").bind("mousedown",function(){audioA.playbackRate=eval($("#pitchA").val())+.1}).bind("mouseup",function(){audioA.playbackRate=eval($("#pitchA").val())});$("#fbB").bind("mousedown",function(){audioB.playbackRate=eval($("#pitchB").val())-.05}).bind("mouseup",function(){audioB.playbackRate=eval($("#pitchB").val())});$("#ffB").bind("mousedown",function(){audioB.playbackRate=eval($("#pitchB").val())+.1}).bind("mouseup",function(){audioB.playbackRate=eval($("#pitchB").val())});$(".waveWrap").bind("click",function(n){var i=$(this).offset(),r=n.pageX-i.left,t=r*100/$(this).width();this.id=="divWaveA"?(audioA.currentTime=GetClosestBeatTime(audioA.duration*t/100,echoA),seekedA=!0):(audioB.currentTime=GetClosestBeatTime(audioB.duration*t/100,echoA),seekedB=!0)});$(document).on("click","#playlistWrapper li",function(){$("#playlistWrapper li.active").removeClass("active");$(this).addClass("active");LoadPlaylist(this)});$(document).on("click","#tracksWrapper .genre a",function(){return GACall("genre",$(this).text()),!1});$(document).on("click","#tracksWrapper .bpm a",function(){return GACall("bpm",$(this).text()),!1});$("#btnSearch").click(SearchTracks);$("#tbSearch").keyup(function(n){n.keyCode==13&&SearchTracks()})}function LoadPlaylist(n){var t,i;$(n).attr("bpm")?$(n).attr("bpm")=="custom"?(t=prompt("Enter BPM",128),t&&GACall("bpm",t)):GACall("bpm",$(n).attr("bpm")):$(n).attr("key")?GACall($(n).attr("key"),upermalink):$(n).attr("genre")?$(n).attr("genre").indexOf("Custom")>-1?(i=prompt("Enter genre",""),i&&GACall("genre",i)):GACall("genre",$(n).attr("genre")):$(n).attr("country")!=undefined?GACall("country",$(n).attr("country")):GACall("spid",$(n).attr("pid"))}function PlayPause(n){n.id=="playA"?audioA.paused?($(n).addClass("active"),audioA.play()):($(n).removeClass("active"),audioA.pause()):n.id=="playB"&&(audioB.paused?($(n).addClass("active"),audioB.play()):($(n).removeClass("active"),audioB.pause()))}function ChangeTempo(n){var i=.0001,t;n.id=="tempoPlusA"?(t=audioA.playbackRate+i,$("#pitchA").val(t.toFixed(4)),sliderChange($("#pitchA")[0])):n.id=="tempoMinusA"?(t=audioA.playbackRate-i,$("#pitchA").val(t.toFixed(4)),sliderChange($("#pitchA")[0])):n.id=="tempoPlusB"?(t=audioB.playbackRate+i,$("#pitchB").val(t.toFixed(4)),sliderChange($("#pitchB")[0])):n.id=="tempoMinusB"&&(t=audioB.playbackRate-i,$("#pitchB").val(t.toFixed(4)),sliderChange($("#pitchB")[0]))}function getMaxVolume(n){for(var i=0,r=n.length,t=0;t<r;t++)i<Math.abs(n[t])&&(i=Math.abs(n[t]));return i}function getAverageVolume(n){for(var i=0,r=n.length,t=0;t<r;t++)i+=Math.abs(n[t]);return i/r}function getAverageVolumeNoAbs(n){for(var i=0,r=n.length,t=0;t<r;t++)i+=n[t];return i/r}function getAverageVolumeSQ(n){for(var i=0,r=n.length,t=0;t<r;t++)i+=n[t]*n[t];return Math.sqrt(i/r)}function BeatMatch(n){var t=n.id=="beatMatchB";diff=lastBeatTimeA-lastBeatTimeB;t?audioB.currentTime=audioB.currentTime-diff:audioA.currentTime=audioA.currentTime-diff}function Sync(n){var u=n.id=="syncB",i=eval($("#enInfoA .tempo").text()),r=eval($("#enInfoB .tempo").text()),t;u?(t=i/r,r=r*t,$("#pitchB").val(t),sliderChange($("#pitchB")[0])):(t=r/i,i=i*t,$("#pitchA").val(t),sliderChange($("#pitchA")[0]))}function GetSCStreamUrl(n){$.ajax({url:"https://mycloudplayers.com/svc/getStreamUrl.ashx",type:"post",data:{url:n.stream_url+"?consumer_key="+soundCloudApiKey},dataType:"json",success:function(n){loadSoundA(n[0])}})}function makeWaveforms(n,t){var i=$(t).height();$.ajax({url:n.replace("w1.","wis."),success:function(n){drawWaveform(n.samples,1,t.find("canvas")[0],"#aaaaaa",n.height);drawWaveform(n.samples,1,t.find("canvas")[1],"#FFAB91",n.height);drawWaveform(n.samples,1,t.find("canvas")[2],"#E64A19",n.height)}})}function drawWaveform(n,t,i,r,u){var f=null,h,c,o,l,e,a,s;if(i&&i.getContext&&(f=i.getContext("2d")),f)for(h=$(i).parent().parent().width(),c=$(i).parent().parent().height(),i.width=h,i.height=c,o=i.height,f.lineWidth="0.0",f.fillStyle=r,l=n.length/i.width*t*2,e=0;e<i.width/t/2;e++)a=Math.floor(e*l),s=n[a]/u*o,drawRectangle(f,e*t*2,o-s,t+t/2,s,!0)}function drawLine(n,t,i,r,u){n.beginPath();n.moveTo(t,i);n.lineTo(r,u);n.closePath();n.stroke()}function drawRectangle(n,t,i,r,u,f){n.beginPath();n.rect(t,i,r,u);n.closePath();f||n.stroke();f&&n.fill()}function copyImageData(n,t){var i=n.createImageData(t.width,t.height);return i.data.set(t.data),i}function drawWaveForm(n){var r=$(n).width(),e=$(n).height(),u=[245,135,0],c=0,f=.5,o=$(n).find(".bg canvas")[0],s=$(n).find(".played canvas")[0],h=$(n).find(".loaded canvas")[0],l=o.getContext("2d"),a=h.getContext("2d"),v=s.getContext("2d"),t,i;for(o.setAttribute("width",r),o.setAttribute("height",e),h.setAttribute("width",r),h.setAttribute("height",e),s.setAttribute("width",r),s.setAttribute("height",e),t=0;t<e;t++)for(i=0;i<r;i++)waveformData.data[(r*t+i)*4]=u[0],waveformData.data[(r*t+i)*4+1]=u[1]-t*f*8,waveformData.data[(r*t+i)*4+2]=u[2],waveformData.data[(r*t+i)*4+3]=255-waveformData.data[(r*t+i)*4+3];for(v.putImageData(waveformData,0,0),c=0,u=[180],t=0;t<e;t++)for(i=0;i<r;i++)waveformData.data[(r*t+i)*4]=u[0]-t*f*10,waveformData.data[(r*t+i)*4+1]=u[0]-t*f*10,waveformData.data[(r*t+i)*4+2]=u[0]-t*f*10,waveformData.data[(r*t+i)*4+3]=waveformData.data[(r*t+i)*4+3]-150;for(a.putImageData(waveformData,0,0),c=0,t=0;t<e;t++)for(i=0;i<r;i++)waveformData.data[(r*t+i)*4]=u[0]-t*f*4,waveformData.data[(r*t+i)*4+1]=u[0]-t*f*4,waveformData.data[(r*t+i)*4+2]=u[0]-t*f*4,waveformData.data[(r*t+i)*4+3]=waveformData.data[(r*t+i)*4+3]-50;l.putImageData(waveformData,0,0)}function flatWaveForm(n){var t=$(n).width(),i=$(n).height(),r=$(n).find(".bg canvas")[0],u=$(n).find(".played canvas")[0],f=$(n).find(".loaded canvas")[0],e=r.getContext("2d"),o=f.getContext("2d"),s=u.getContext("2d");r.setAttribute("width",t);r.setAttribute("height",i);f.setAttribute("width",t);f.setAttribute("height",i);u.setAttribute("width",t);u.setAttribute("height",i);s.clearRect(0,0,t,i);o.clearRect(0,0,t,i);e.clearRect(0,0,t,i);e.fillStyle="#444444";e.fillRect(0,i/2-10,t,20);o.fillStyle="#777777";o.fillRect(0,i/2-10,t,20);s.fillStyle=gradient;s.fillRect(0,i/2-20,t,40)}function onprogressHTML(n){var t=document.getElementById(n.srcElement&&n.srcElement.id||n.target&&n.target.id),i;t&&t.buffered&&t.buffered.length&&(i=Math.round(t.buffered.end(0)*100/t.duration),t.id=="audioA"?$waveALoaded.css("width",i+"%"):$waveBLoaded.css("width",i+"%"))}function changeFrequency(n,t){var i=context.sampleRate/2,r=Math.log(i/40)/Math.LN2,u=Math.pow(2,r*(t-1));n.frequency.value=i*u}function changeQuality(n,t){n.Q.value=t*QUAL_MUL}function GetClosestBeatTime(n){return n}function isBeat(n,t){var i=findNextBeat(n,t);return i&&i.confidence>0&&i.start>=t-i.duration/2?(n?(i.duration>0&&(beatDurationA=i.duration),bpmcA=bpmcA?(bpmcA+60/beatDurationA)/2:60/beatDurationA,$tempoA.text((bpmcA*pitchA).toFixed(1))):(i.duration>0&&(beatDurationB=i.duration),bpmcB=bpmcB?(bpmcB+60/beatDurationB)/2:60/beatDurationB,$tempoB.text((bpmcB*pitchB).toFixed(1))),!0):!1}function findNextBeat(n,t){var u=n?echoA:echoB,i,r;if(u){var f=u.beats,e=f.length,o=n?beatIndexA:beatIndexB;for(i=o;i<e;i++)if(r=f[i],t>=r.start&&t<r.start+r.duration/20)return n?beatIndexA=i:beatIndexB=i,r;n?beatIndexA=0:beatIndexB=0}return null}function setToken(n){var t="https://api.soundcloud.com/me.json?oauth_token="+n+"&client_id="+soundCloudApiKey2;userToken=n;$.ajax({url:t,success:function(n){upermalink=n.permalink;GetUserPlaylists(n.permalink)}})}function getToken(){var n=(new Date).getTime();if(tokenObj=JSON.parse(localStorage.getItem("scAuth")),tokenObj&&tokenObj.token&&tokenObj.host==="soundcloud.com"&&n-new Date(tokenObj.date)<2592e6)setToken(tokenObj.token);else if(getCookie("scToken"))setToken(getCookie("scToken"));else return undefined}function GACall(n,t,i,r,u){setTimeout(function(){i==!1||(window.location.hash=="#!/"+n.toLowerCase()+(r?"":"="+encodeURIComponent(t))?ProcessParams(!0):window.location.hash="!/"+n.toLowerCase()+(r?"":"="+encodeURIComponent(t)));u?ga("send","event","MyCloudPlayer",n,t+(scUserID?"-"+scUserID:""),u):ga("send","event","MyCloudPlayer",n,t+(scUserID?"-"+scUserID:""));ga("send","pageview")},10)}function SetPLStatus(n){$("#statusTooltip").html(n).dialog({dialogClass:"statusMsg",draggable:!1,resizable:!1,position:"center",hide:"fade",zIndex:999999});setTimeout(function(){$("#statusTooltip").dialog("close")},5e3)}function filterSegments(n){var t=[],r,i,u;for(t.push(n.segments[0]),r=1;r<n.segments.length;r++)i=n.segments[r],u=t[t.length-1],isSimilar(i,u)&&i.confidence<.3?t[t.length-1].duration+=i.duration:t.push(i);n.fsegments=t}function isSimilar(n,t){var i=timbral_distance(n,t);return i<1}function euclidean_distance(n,t){for(var r,u=0,i=0;i<3;i++)r=t[i]-n[i],u+=r*r;return Math.sqrt(u)}function timbral_distance(n,t){return euclidean_distance(n.timbre,t.timbre)}function setCookie(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";deleteCookie(n);document.cookie=n+"="+t+u+"; path=/; domain=mycloudplayers.com"}function getCookie(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return null}var holderA,holderB,canvasRTWidth,canvas,ctx,canvas2,ctx2,rtWaveA,rtWaveB,jsProcessorB,processAudioB,presetPlaylists,genrePlaylists,scUserID,$tempoA,$tempoB,$waveALoaded,$waveBLoaded,userToken,beatIndexA,beatIndexB;requestAnimationFrame=requestAnimationFrame||webkitRequestAnimationFrame;getAudioContext=function(){return typeof webkitAudioContext!="undefined"?new webkitAudioContext:typeof AudioContext!="undefined"?new AudioContext:undefined};getAudioContext()||alert("This app works only on latest webKit (Chrome and Safari) browsers");holderA=document.getElementById("deckA");holderA.ondragover=function(){return this.className="deck hover",!1};holderA.ondragend=function(){return this.className="deck",!1};holderA.ondrop=function(n){this.className="deck";n.preventDefault();var t=window.webkitURL.createObjectURL(n.dataTransfer.files[0]);return createAudioA(),audioA.src=t,$("#deckA .infos").remove(),$(".playA").removeClass("active"),$("#deckA .trackInfo").html(n.dataTransfer.files[0].name),$tempoA.text(""),$tempoADiff.text(""),trackA=null,echoA=null,flatWaveForm($("#divWaveA")[0]),GACall("play",n.dataTransfer.files[0].name,!1),!1};holderB=document.getElementById("deckB");holderB.ondragover=function(){return this.className="deck hover",!1};holderB.ondragend=function(){return this.className="deck",!1};holderB.ondrop=function(n){this.className="deck";n.preventDefault();var t=window.webkitURL.createObjectURL(n.dataTransfer.files[0]);return createAudioB(),audioB.src=t,$("#deckB .infos").remove(),$(".playB").removeClass("active"),$("#deckB .trackInfo").html(n.dataTransfer.files[0].name),$tempoB.text(""),$tempoBDiff.text(""),trackB=null,echoB=null,flatWaveForm($("#divWaveB")[0]),GACall("play",n.dataTransfer.files[0].name,!1),!1};var holoColors=["#e51c23","#e91e63","#9c27b0","#673ab7","#3f51b5","#5677fc","#03a9f4","#00bcd4","#009688","#259b24","#8bc34a","#ff9800","#ff5722"],currentColors=[],upermalink="",canvasPWidth=$("canvas.fft").parent().width();$("canvas.fft").width("100%").height(80);canvasRTWidth=$("canvas#waveA").parent().width();$("canvas.rtWave").width("100%").height(40);canvas=document.getElementById("fft");ctx=canvas.getContext("2d");canvas.width=canvasPWidth;canvas2=document.getElementById("fft2");ctx2=canvas2.getContext("2d");canvas2.width=canvasPWidth;rtWaveA=document.getElementById("waveA");rtWaveB=document.getElementById("waveB");rtWaveA.width=canvasRTWidth;rtWaveB.width=canvasRTWidth;var CANVAS_HEIGHT=canvas.height,CANVAS_WIDTH=canvas.width,bufferA,bufferB,gradient=ctx.createLinearGradient(0,0,0,80);gradient.addColorStop(1,"#F8350E");gradient.addColorStop(0,"#FF9911");var sourceA,sourceB,context=getAudioContext(),analyserA=context.createAnalyser(),analyserB=context.createAnalyser(),analyserAW=context.createAnalyser(),analyserBW=context.createAnalyser(),gainNodeA=context.createGain(),gainNodeB=context.createGain(),gainNodeAA=context.createGain(),gainNodeBB=context.createGain(),jsProcessorA=context.createScriptProcessor(2048,1,1);jsProcessorA.onaudioprocess=processAudioA;jsProcessorB=context.createScriptProcessor(2048,1,1);jsProcessorB.onaudioprocess=processAudioB;var filterA=context.createBiquadFilter(),bassA=context.createBiquadFilter(),trebleA=context.createBiquadFilter(),midA=context.createBiquadFilter(),gainBassA=context.createGain(),gainMidA=context.createGain(),gainTrebleA=context.createGain(),bassB=context.createBiquadFilter(),trebleB=context.createBiquadFilter(),midB=context.createBiquadFilter(),gainBassB=context.createGain(),gainMidB=context.createGain(),gainTrebleB=context.createGain(),filterB=context.createBiquadFilter(),ftimer=0,seekedA=!1,seekedB=!1,trackA,trackB,echoA,echoB,pitchA=1,pitchB=1,BiquadFilterType=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];var rtWaveADom,rtWaveBDom,$tempoA,$tempoB,$tempoADiff,$tempoBDiff,lowFreq=440,hiFreq=1760,midFreq=2e3;setupFilter(filterA);setupFilter(filterB);getAudioContext()||alert("Web Audio isn't available in your browser. But...you can still play the HTML5 audio :)");var coef=3/4,SPACER_WIDTH=4*coef,BAR_WIDTH=3*coef,OFFSET=550,CUTOFF=23,numBars=Math.round(CANVAS_WIDTH/SPACER_WIDTH)-2;processAudioB=function(n){if(sourceB.mediaElement&&!sourceB.mediaElement.paused){var i=n.inputBuffer.getChannelData(0),t=new Uint8Array(analyserB.frequencyBinCount);analyserB.getByteFrequencyData(t);analyserB.fftSize=2048;return}};var processAudioA=function(n){if(sourceA.mediaElement&&!sourceA.mediaElement.paused){var t=n.inputBuffer.getChannelData(0);bdA.process(context.currentTime,t);kickA.process(bdA);kickA.is_kick&&console.log(kickA.is_kick)}},hot=new chroma.ColorScale({colors:["#eeeeee","#FFA000","#FF6F00","#D50000"],positions:[.4,.6,.8,1],mode:"rgb",limits:[0,256]}),avgMaxVolA=1,avgMaxVolB=1;window.addEventListener("load",onLoad,!1);presetPlaylists=[{title:"Custom BPM ",bpm:"custom"},{title:"96 BPM ",bpm:95},{title:"100 BPM ",bpm:100},{title:"110 BPM ",bpm:110},{title:"120 BPM ",bpm:120},{title:"128 BPM ",bpm:128},{title:"145 BPM ",bpm:145},{title:"160 BPM ",bpm:160}];genrePlaylists=["Custom Genre","Acid","Ambient","Bass","Breakbeat","Chillout","Dance","Deep","Disco","Downtempo","Drumstep","Dubstep","Electronic","Funk","Fusion","Groove","Hiphop","Hot","House","Idm","Indie","Industrial","Jungle","Lounge","Minimal","Party","Pop","Progressive","Rap","Rave","Reggae","Rnb","Rock","Techno","Trance","Tribal","Triphop"];var soundCloudApiKey="ggX0UomnLs0VmW7qZnCzw",soundCloudApiKey2="ggX0UomnLs0VmW7qZnCzw",soundCloudApiKeyX="ggX0UomnLs0VmW7qZnCzw",tracks=[];var val,up=0,down=0,i=0,working=!1;$(document).ready(function(){$(window).on("focus",function(){working||(working=!0,userToken?GetUserPlaylists(upermalink):getToken(),setTimeout(function(){working=!1},100))});$(document).on("click","#playlistWrapper h3",function(){$(this).next().slideToggle("medium");$(this).toggleClass("collapsed")});$("input.knob.treble, input.knob.middle, input.knob.bass").parent().on("dblclick",function(){$(this).find("input.knob").val(1).trigger("change");var n=$(this).find("input.knob")[0];$(this).find("label").html(0);sliderChange(n)});$("input.vertical").on("dblclick",function(){$(this).val(1)});$.each($("input.knob"),function(n,t){$(t).attr("data-max",$(t).attr("max")).attr("data-min",$(t).attr("min"))});var n={width:44,height:44,fgColor:"#DD2C00",angleOffset:-160,displayPrevious:!0,skin:"tron",angleArc:320,displayInput:!1,cursor:!1,change:function(n){this.$.parent().parent().find("input").hasClass("treble")||this.$.parent().parent().find("input").hasClass("bass")||this.$.parent().parent().find("input").hasClass("middle")?this.$.parent().parent().find("label").html((n*20-20).toFixed(0)):this.$.parent().parent().find("label").html(n.toFixed(0));sliderChange(this.$[0]);val=n},release:function(n){this.$.parent().parent().find("input").hasClass("treble")||this.$.parent().parent().find("input").hasClass("bass")||this.$.parent().parent().find("input").hasClass("middle")?this.$.parent().parent().find("label").html((n*20-20).toFixed(0)):this.$.parent().parent().find("label").html(n.toFixed(0));sliderChange(this.$[0]);val=n}};n.fgColor="#0091EA";$("input.volume").knob(n);n.fgColor="#558B2F";$("input.freq").knob(n);n.fgColor="#689F38";$("input.kq").knob(n);n.fgColor="#DD2C00";$("input.treble").knob(n);n.fgColor="#FFAB00";$("input.middle").knob(n);n.fgColor="#689F38";$("input.bass").knob(n);BindEvents();DefineDomElements();getToken();CreatePlaylists();CreateGenrePlaylists();getTopCountries();setTimeout(function(){location.hash.replace("#/","").length==0?GACall("country",""):ProcessParams();$(".knob").each(function(){$(this).val(this.value).trigger("change");$(this).parent().parent().find("input").hasClass("treble")||$(this).parent().parent().find("input").hasClass("bass")||$(this).parent().parent().find("input").hasClass("middle")?$(this).parent().parent().find("label").html((this.value*20-20).toFixed(0)):$(this).parent().parent().find("label").html(eval(this.value).toFixed(0))})},100);modifyInputs()});scUserID="";userToken="1";var sampleRate=44100,signal=new Float32Array(2048),freqz=[0],grapheq,FREQ_MUL=7e3,QUAL_MUL=30;var lastBeatA=0,lastBeatB=0,lastBeatTimeA=0,lastBeatTimeB=0,beatDurationA=0,beatDurationB=0,beatDurationAA=0,beatDurationBB=0,bpmcA=0,bpmcB=0;beatIndexA=0;beatIndexB=0;window.onhashchange=ProcessParams;gainNodeAA.gain.value=0;gainNodeBB.gain.value=0
